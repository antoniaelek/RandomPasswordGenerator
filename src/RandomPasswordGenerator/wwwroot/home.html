<html>
  <head>
    <script type="text/javascript" src="./lib/knockout/dist/knockout.js"></script>
    <script type="text/javascript" src="./lib/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="./lib/jquery.validation/dist/jquery.validate.min.js"></script>
    <script type="text/javascript" src="./lib/bootstrap/dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="./lib/bootstrap/dist/css/bootstrap.min.css" media="screen" />
  </head>
  <body>
    <div class="container" id="reg-container">
        <h1>
            Random Password Generator 
            <button class="btn btn-success" onclick="location.href='/register.html';">Register</button>
            <button class="btn btn-info" onclick="location.href='/login.html';">Login</button>
        </h1>
        <hr/>
        <form id="myform">
            <div class="form-group row">
                <label for="length" class="col-md-2 control-label" style="padding-top: 5px;">Password length</label>
                <div class="col-md-5">
                    <input type="length" class="form-control col-md-9" id="length" placeholder="you@mail.com" 
                    name="length" data-bind="value: length" required/>
                </div>
            </div>
            <div class="form-group row">
                <label for="upperCase" class="col-md-2 control-label" style="padding-top: 5px;">Uppercase letters</label>
                <div class="col-md-5">
                    <label class="col-md-2">Yes 
                        <input type="radio" id="upperCase" value="true" name="upperCase" data-bind="checked:UpperCase.ForEditing" required/>
                    </label>
                    <label class="col-md-2">No 
                        <input type="radio" id="upperCase" value="false" name="upperCase" data-bind="checked:UpperCase.ForEditing" required/>
                    </label>
                </div>
            </div>
            <div class="form-group row">
                <label for="lowerCase" class="col-md-2 control-label" style="padding-top: 5px;">Lowercase letters</label>
                <div class="col-md-5">
                    <label class="col-md-2">Yes 
                        <input type="radio" id="lowerCase" value="true" name="lowerCase" data-bind="checked:lowerCase.ForEditing" required/>
                    </label>
                    <label class="col-md-2">No 
                        <input type="radio" id="lowerCase" value="false" name="lowerCase" data-bind="checked:lowerCase.ForEditing" required/>
                    </label>
                </div>
            </div>
            <div class="form-group row">
                <label for="digits" class="col-md-2 control-label" style="padding-top: 5px;">Digits</label>
                <div class="col-md-5">
                    <label class="col-md-2">Yes 
                        <input type="radio" id="digits" value="true" name="digits" data-bind="checked:digits.ForEditing" required/>
                    </label>
                    <label class="col-md-2">No 
                        <input type="radio" id="digits" value="false" name="digits" data-bind="checked:digits.ForEditing" required/>
                    </label>
                </div>
            </div>
            <div class="form-group row">
                <label for="symbols" class="col-md-2 control-label" style="padding-top: 5px;">Symbols</label>
                <div class="col-md-5">
                    <label class="col-md-2">Yes 
                        <input type="radio" id="symbols" value="true" name="symbols" data-bind="checked:symbols.ForEditing" required/>
                    </label>
                    <label class="col-md-2">No 
                        <input type="radio" id="symbols" value="false" name="symbols" data-bind="checked:symbols.ForEditing" required/>
                    </label>
                </div>
            </div>
            <div class="form-group row">
                <label for="hint" class="col-md-2 control-label" style="padding-top: 5px;">Hint</label>
                <div class="col-md-5">
                    <input type="hint" class="form-control col-md-9" id="hint" placeholder="hint" 
                    name="hint" data-bind="value: hint" required/>
                </div>
            </div>

            <button class="btn btn-success" data-bind="click: register">Generate password</button>
        </form>
    </div>

    <script type="text/javascript">
      
      function RegisterViewModel() {
        this.length = ko.observable();
        this.upperCase = ko.observable(true);
        this.lowerCase = ko.observable(true);
        this.digits = ko.observable(true);
        this.symbols = ko.observable(true);
        this.hint = ko.observable("");

        this.upperCase.ForEditing = ko.computed({
            read: function() {
                return this.upperCase().toString();  
            },
            write: function(newValue) {
                this.upperCase(newValue === "true");
            },
            owner: this        
        });    

        this.lowerCase.ForEditing = ko.computed({
            read: function() {
                return this.lowerCase().toString();  
            },
            write: function(newValue) {
                this.lowerCase(newValue === "true");
            },
            owner: this        
        });   

        this.digits.ForEditing = ko.computed({
            read: function() {
                return this.digits().toString();  
            },
            write: function(newValue) {
                this.digits(newValue === "true");
            },
            owner: this        
        });   

        this.symbols.ForEditing = ko.computed({
            read: function() {
                return this.symbols().toString();  
            },
            write: function(newValue) {
                this.symbols(newValue === "true");
            },
            owner: this        
        });   
        
        self.register = function() {
            $("#myform").validate();
            if ($('#myform').valid() == false) {
                
            }
            else{
                $.ajax("/api/user", {
                    data: ko.toJSON({ 
                        lowerCase: this.lowerCase, 
                        upperCase: this.upperCase, 
                        length: this.length, 
                        digits: this.digits,
                        symbols: this.symbols,
                        hint: this.hint
                    }),
                    type: "post", 
                    contentType: "application/json",
                    dataType: 'json',
                    success: function(result) {
                        console.log(result);
                        $("#reg-container").hide();
                        //window.location.replace("user.html?user="+result.userName);
                    }
                });
            }
        }; 

      }

      // Activates knockout.js
      ko.applyBindings(new RegisterViewModel());
    </script>
  </body>
</html>